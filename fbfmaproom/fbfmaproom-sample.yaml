mode: debug  # debug, devel or prod

# use 0.0.0.0 if you want to connect from another machine. Only
# affects development configuration.
dev_server_interface: 127.0.0.1
dev_server_port: 8050
dev_processes: 4

prefix: https://iridl.ldeo.columbia.edu
core_path: /fbfmaproom
admin_path: /fbfmaproom-admin
tile_path: /fbfmaproom-tiles
support_email: help@iri.columbia.edu
bypass_dlauth: true
loglevel: info
gantt_url: https://fist-fbf-gantt2.iri.columbia.edu/gantt?

dlauth_client:
    prefix: https://iridl.ldeo.columbia.edu
    core_path: /auth
    session_cookie_name: __dlauth_id
    application_ssid: SNIP

dbpool:
    name: DesignEngine  # postgres database name
    host: pgdb12.iri.columbia.edu
    port: 5432
    user: dero  # user name
    password: SNIP
    capacity: 10  # number of connections in pool
    close_on_exception: true
    max_idle_time: 60  # (seconds)
    max_open_time: 600  # (seconds)
    max_usage_count: 1000
    recycle_interval: 60  # (seconds) set to null to disable recycler thread

enso_ds: &enso_ds
    label: ENSO State
    units:
    path: enso.zarr
    var_names:
        time: T
        obs: dominant_class
    range: [1, 3]
    colormap: []
    lower_is_worse: no
    format: enso

data_root: /data/aaron/fbf

custom_asset_path: /path/to/my/custom/icons/directory

countries:
    malawi:
        logo: Malawi_IRI_98x48.png
        resolution: [1, 1]
        center: [37.5, -13]
        zoom: 7
        rotation: 0
        marker: [34, -14]
        onload_warning: &warn "This is a new version that does not use the current year's forecast in the trigger calculation."
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Malawi'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Malawi' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Malawi'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Malawi' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Malawi'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Malawi' group by 1, 2
        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years
            observations:
                rain:
                    label: Rain
                    description: CMAP average precipitation over the season
                    path: rain-malawi.zarr
                    var_names:
                        obs: prcp_est
                        lat: Y
                        lon: X
                        time: T
                    colormap: &raincm "[16777215 16777215 12632256 12632256 14155730
                        [14155730 21] 12841150 [12841150 23] 10215830 [10215830 23]
                        7262835 [7262835 22] 6931300 [6931300 23] 5944410 [5944410 23]
                        5285200 [5285200 23] 4625990 [4625990 22] 3966780 [3966780 23]
                        3307570 [3307570 23] 2648360 [2648360 23] 1989150]"
                    lower_is_worse: yes
                enso_state: *enso_ds
                bad-years:
                    label: Reported bad years
                    path: malawi/bad-years.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: IRI Flexible Seasonal Forecast probability of non-exceedance of the selected percentile
                    path: pnep-malawi.zarr
                    var_names:
                        pne: prob
                        lat: Y
                        lon: X
                        issue: S
                        lead: L
                        pct: P
                    colormap: &pnepcm "[0x0000ba 0x004fff 0x3ec5f5 0x7fffd4 0x97fc00
                        0xd8fe00 0xffe800 0xffac00 0xff7b00 0xff5900 0xff3500 0xff1300
                        0xef0000 0xd10000 0xb00000 0x8f0000 [0x800000 4]]"
                    lower_is_worse: no
            vuln:
                colormap: &vulncm "[0xffff00 [0xffff00 4] 0xfff500 0xffde00 0xffc300 0xffae00
                    0xff9900 0xff7e00 0xff6200 0xff4600 0xff2f00 0xff0b00 0xf70000
                    0xdb0000 0xbf0000 0xa60000 0x8a0000 [0x800000 5]]"
                range: [0.0, 5.0]
        seasons:
            season1:
                label: DJF
                target_month: 0.5  # season center in months since Jan 1: 0.0 <= season < 12.0
                length: 3.0
                issue_months: [7, 8, 9, 10]  # months since Jan 1: 0.0 <= season < 12.0
                year_range: [1983, 2021]

    madagascar:
        logo: Madagascar_IRI_98x48.png
        resolution: [.0375, .0375]
        center: [49, -23]
        zoom: 7
        rotation: 0
        marker: [45.5, -24]
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(ST_Union(the_geom)) as the_geom
                  from iridb.g2015_2014_1 g where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
                  group by 1, 2
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years
            observations:
                rain:
                    label: Rain
                    description: ENACTS average precipitation over the season
                    path: madagascar/enacts-precip-djf.zarr
                    var_names:
                        obs: rfe
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enso_state: *enso_ds
                bad-years:
                    label: Reported bad years
                    path: madagascar/bad-years.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of the selected percentile
                    path: madagascar/pnep-djf.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: DJF
                target_month: 0.5  # season center in months since Jan 1: 0.0 <= season < 12.0
                length: 3.0
                issue_months: [8, 9, 10]  # months since Jan 1: 0.0 <= season < 12.0
                year_range: [1982, 2022]

    madagascar-ond:
        logo: Madagascar_IRI_98x48.png
        resolution: [.0375, .0375]
        center: [49, -23]
        zoom: 7
        rotation: 0
        marker: [45.5, -24]
        clip: no
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(ST_Union(the_geom)) as the_geom
                  from iridb.g2015_2014_1 g where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
                  group by 1, 2
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

        datasets:
            defaults:
                predictors:
                    - pnep
                    - enacts-precip-mon
                predictand: bad-years
            observations:
                enacts-precip-mon:
                    label: ENACTS MON precip
                    description: ENACTS monitoring average precipitation over the season
                    path: madagascar/enacts-precip-mon-ond.zarr
                    var_names:
                        obs: rfe
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enacts-precip:
                    label: ENACTS ALL precip
                    description: ENACTS all stations average precipitation over the season
                    path: madagascar/enacts-precip-ond.zarr
                    var_names:
                        obs: rfe
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                chirps-precip-ond:
                    label: CHIRPS Precip
                    description: CHIRPS average precipitation over the season
                    path: madagascar/chirps-precip-ond.zarr
                    var_names:
                        obs: precipitation
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                ndvi:
                    label: NDVI
                    description: MODIS NDVI average over the season
                    path: madagascar/ndvi-ond.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                wrsi:
                    label: WRSI
                    path: madagascar/wrsi-ond.zarr
                    var_names:
                        obs: do
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                spi:
                    label: ENACTS MON SPI
                    description: SPI calculated from ENACTS monitoring product
                    path: madagascar/enacts-mon-spi-ond.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                enso_state: *enso_ds
                bad-years:
                    label: Drought humanitarian ranking
                    description: Drought ranking of expert committee humanitarian data review
                    path: madagascar/bad-years-ond.zarr
                    var_names:
                        obs: rank
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of the selected percentile
                    path: madagascar/pnep-ond.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: OND
                target_month: 10.5  # season center in months since Jan 1: 0.0 <= season < 12.0
                length: 3.0
                issue_months: [6, 7, 8]  # months since Jan 1: 0.0 <= season < 12.0
                year_range: [1993, 2022]

    ethiopia:
        logo: Ethiopia_IRI_98x48.png
        resolution: [.25, .25]
        center: [43.875, 6.875]
        zoom: 6
        rotation: 0
        marker:  [43.875, 6.875]
        origin: [.125, .125]
        onload_warning: *warn
        shapes:
            - name: Regional
              sql: select (adm1_pcode) as key, adm1_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_region
              vuln_sql: select (adm1_pcode) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability_ethiopia_somali group by 1, 2

            - name: Zonal
              sql: select (adm1_pcode, adm2_pcode) as key, adm2_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_zone
              vuln_sql: select (adm1_pcode, adm2_pcode) as key, year, vulnerability as vuln
                  from public.fbf_vulnerability_ethiopia_somali

            - name: Woreda
              sql: select (adm1_pcode, adm2_pcode, adm3_pcode) as key, adm3_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_woreda
              vuln_sql: select (g.adm1_pcode, g.adm2_pcode, g.adm3_pcode) as key, g.adm3_en as label,
                  v.year, v.vulnerability as vuln from iridb.somali_woreda as g join
                  public.fbf_vulnerability_ethiopia_somali as v on (g.adm1_pcode=v.adm1_pcode and
                  g.adm2_pcode=v.adm2_pcode)

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years
            observations:
                rain:
                    label: Rain
                    description: CHIRPS average precipitation over the season
                    path: ethiopia/rain-mam.zarr
                    var_names:
                        obs: prcp
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enso_state: *enso_ds
                ndvi:
                    label: NDVI
                    path: ndvi-ethiopia.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                spi:
                    label: SPI
                    description: SPI calculated from CHIRPS
                    path: ethiopia/spi-mam.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                rain-prev-seas:
                    label: Rain prev OND
                    description: CHIRPS average precipitation over the previous OND season
                    path: ethiopia/rain-prev-seas-mam.zarr
                    var_names:
                        obs: prcp
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                ndvi-prev-seas:
                    label: NDVI prev OND
                    description: Average NDVI over the previous OND season
                    path: ethiopia/ndvi-prev-seas-mam.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                spi-prev-seas:
                    label: SPI prev OND
                    description: SPI calculated from CHIRPS for previous OND season
                    path: ethiopia/spi-prev-seas-mam.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                bad-years:
                    label: Reported bad years
                    path: ethiopia/bad-years-mam.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of selected percentile
                    path: ethiopia/pnep-mam.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: MAM
                target_month: 3.5
                length: 3.0
                issue_months: [11, 0, 1]
                year_range: [1983, 2022]
    ethiopia-ond:
        logo: Ethiopia_IRI_98x48.png
        resolution: [.25, .25]
        center: [43.875, 6.875]
        zoom: 6
        rotation: 0
        marker:  [43.875, 6.875]
        origin: [.125, .125]
        onload_warning: *warn
        shapes:
            - name: Regional
              sql: select (adm1_pcode) as key, adm1_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_region
              vuln_sql: select (adm1_pcode) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability_ethiopia_somali group by 1, 2

            - name: Zonal
              sql: select (adm1_pcode, adm2_pcode) as key, adm2_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_zone
              vuln_sql: select (adm1_pcode, adm2_pcode) as key, year, vulnerability as vuln
                  from public.fbf_vulnerability_ethiopia_somali

            - name: Woreda
              sql: select (adm1_pcode, adm2_pcode, adm3_pcode) as key, adm3_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_woreda
              vuln_sql: select (g.adm1_pcode, g.adm2_pcode, g.adm3_pcode) as key, g.adm3_en as label,
                  v.year, v.vulnerability as vuln from iridb.somali_woreda as g join
                  public.fbf_vulnerability_ethiopia_somali as v on (g.adm1_pcode=v.adm1_pcode and
                  g.adm2_pcode=v.adm2_pcode)

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years
            observations:
                rain:
                    label: Rain
                    description: CHIRPS average precipitation
                    path: ethiopia/rain-ond.zarr
                    var_names:
                        obs: prcp
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                ndvi:
                    label: NDVI
                    path: ethiopia/ndvi-ond.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                spi:
                    label: SPI
                    description: SPI calculated from CHIRPS
                    path: ethiopia/spi-ond.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                rain-prev-seas:
                    label: Rain prev MAM
                    description: CHIRPS average precipitation over the previous MAM season
                    path: ethiopia/rain-prev-seas-ond.zarr
                    var_names:
                        obs: prcp
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                ndvi-prev-seas:
                    label: NDVI prev MAM
                    description: Average NDVI over the previous MAM season
                    path: ethiopia/ndvi-prev-seas-ond.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                ndvi-jun:
                    label: NDVI June
                    description: Average NDVI for June
                    path: ethiopia/ndvi-jun-ond.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                ndvi-jul:
                    label: NDVI July
                    description: Average NDVI for July
                    path: ethiopia/ndvi-jul-ond.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                ndvi-aug:
                    label: NDVI August
                    description: Average NDVI for August
                    path: ethiopia/ndvi-aug-ond.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                spi-prev-seas:
                    label: SPI prev MAM
                    description: SPI for previous MAM season, calculated from CHIRPS
                    path: ethiopia/spi-prev-seas-ond.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                enso_state: *enso_ds
                bad-years:
                    label: Reported bad years
                    path: ethiopia/bad-years-ond.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of selected percentile
                    path: ethiopia/pnep-ond.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season2:
                label: OND
                target_month: 10.5
                length: 3.0
                issue_months: [8, 7, 6]
                year_range: [1982, 2022]
    niger:
        logo: Niger_IRI_120x48.png
        resolution: [0.05, 0.05]
        center: [8.1, 17]
        zoom: 6
        rotation: 0
        marker: [8.025, 17.025]
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Niger'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Niger' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Niger'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Niger' group by 1, 2

            - name: Department
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Niger'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Niger' group by 1, 2

            - name: Commune
              sql: select rowcacode3 as key, adm_03 as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.ner_adm03_feb2018
              vuln_sql: select null as key, 0 as year, 0 as vuln where 1 = 2
              # ^ placeholder sql until we have vulnerabilities for the Commune level.
              # note that the type of each column must be correct or the generated
              # query will fail (in this case vuln needs to be a number), even if
              # there are zero rows

        datasets:
            defaults:
              predictors:
                - pnep
                - chirp-spi-jj
              predictand: bad-years
            observations:
                enacts-precip-jas:
                    label: ENACTS Precip JAS
                    description: ENACTS total precipitation for Jul-Sep
                    path: niger/enacts-precip-jas.zarr
                    var_names:
                        obs: obs
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                chirps-precip-jun:
                    label: CHIRPS Precip Jun
                    description: CHIRPS total precipitation for Jun
                    path: niger/chirps-precip-jun.zarr
                    var_names:
                        obs: precipitation
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                chirps-precip-jjaso:
                    label: CHIRPS Precip Jun-Oct
                    description: CHIRPS total precipitation for Jun-Oct
                    path: niger/chirps-precip-jjaso.zarr
                    var_names:
                        obs: precipitation
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                chirps-precip-jas:
                    label: CHIRPS Precip JAS
                    description: CHIRPS total precipitation for Jul-Sep
                    path: niger/chirps-precip-jas.zarr
                    var_names:
                        obs: precipitation
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enacts-spi-jas:
                    label: ENACTS SPI JAS
                    description: Average SPI over the season, calculated from ENACTS
                    path: niger/enacts-spi-jas.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                enacts-spi-jj:
                    label: ENACTS SPI Jun-Jul
                    description: Average SPI in June-July, calculated from ENACTS
                    path: niger/enacts-spi-jj.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                enacts-mon-spi-jj:
                    label: ENACTS MON SPI Jun-Jul
                    description: Average SPI in June-July, calculated from ENACTS monitoring product
                    path: niger/enacts-mon-spi-jj.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                chirp-spi-jj:
                    label: CHIRP SPI Jun-Jul
                    description: Average SPI in June-July, calculated from CHIRP
                    path: niger/chirp-spi-jj.zarr
                    var_names:
                        obs: spi
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
                chirps-dryspell:
                    label: Dry Spell
                    description: Longest dry spell, calculated from CHIRPS
                    path: niger/chirps-dryspell.zarr
                    var_names:
                        obs: lls
                        lat: Y
                        lon: X
                        time: T
                    units: days
                    colormap: *raincm
                    lower_is_worse: no
                    format: timedelta_days
                chirps-onset:
                    label: Onset
                    description: Onset of rain, calculated from CHIRPS
                    path: niger/chirps-onset.zarr
                    var_names:
                        obs: adif
                        lat: Y
                        lon: X
                        time: T
                    units: days after May 1
                    colormap: *raincm
                    lower_is_worse: no
                    format: timedelta_days
                enso_state: *enso_ds
                bad-years:
                    label: Reported bad years
                    path: niger/bad-years.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
                station-spi-jj:
                    label: Station SPI Jun-Jul
                    description: Average SPI in June-July, calculated from DMN weather station data.
                    path: niger/station-spi-jj.zarr
                    var_names:
                        obs: Average
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number3
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of the selected percentile
                    path: niger/pnep-jas.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: JAS
                target_month: 7.5
                length: 3.0
                issue_months: [0, 1, 2, 3, 4, 5]
                year_range: [1991, 2022]

    guatemala:
        logo: Guatemala_IRI_120x48.png
        resolution: [.1, .1]
        center: [-89, 16]
        zoom: 8
        rotation: 0
        marker:  [-90, 16]
        origin: [0, 0]
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Guatemala'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Guatemala' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Guatemala'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Guatemala' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Guatemala'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Guatemala' group by 1, 2

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years
            observations:
                rain:
                    label: Rain
                    description: CHIRPS average precipitation over the season
                    path: rain-guatemala.zarr
                    var_names:
                        obs: prcp_est
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enso_state: *enso_ds
                bad-years:
                    label: Reported bad years
                    path: guatemala/bad-years.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of selected percentile
                    path: pnep-guatemala.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: OND
                target_month: 10.5
                length: 3.0
                issue_months: [8]
                year_range: [1996, 2021]

    djibouti:
        logo: Djibouti_IRI.svg
        resolution: [.25, .25]
        center: [43, 12]
        zoom: 8
        rotation: 0
        marker:  [43, 12]
        origin: [.125, 125]
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Djibouti'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Djibouti' group by 1, 2

            - name: Regional
              sql: select code as key, INITCAP(district) as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.djibouti_adm01
              vuln_sql: select null as key, 0 as year, 0 as vuln
              # vuln_sql: select code as key, year, sum(vulnerability) as vuln
              #     from public.fbf_vulnerability where adm0_name = 'Djibouti' group by 1, 2

            - name: District
              sql: select adm2_pcode as key, adm2_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.djibouti_adm02
              vuln_sql: select null as key, 0 as year, 0 as vuln
              # vuln_sql: select adm2_pcode as key, year, sum(vulnerability) as vuln
              #     from public.fbf_vulnerability where adm0_name = 'Djibouti' group by 1, 2

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years
            observations:
                rain:
                    label: Rain
                    description: CHIRPS average precipitation over the season
                    path: rain-djibouti.zarr
                    var_names:
                        obs: prcp
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                ndvi:
                    label: NDVI
                    path: ndvi-djibouti.zarr
                    var_names:
                        obs: NDVI
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number4
                enso_state: *enso_ds
                bad-years:
                    label: Reported bad years
                    path: djibouti/bad-years.zarr
                    var_names:
                        obs: bad
                        time: T
                    colormap: *raincm
                    lower_is_worse: no
                    format: bad
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of selected percentile
                    path: djibouti/pnep-jas.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: JAS
                target_month: 7.5
                length: 3.0
                issue_months: [3, 4, 5]
                year_range: [1990, 2022]

    lesotho:
        logo: Lesotho_IRI_94x48.png
        resolution: [.0375, .0375]
        center: [28.25625, -29.606]
        zoom: 8
        rotation: 0
        marker:  [28.25625, -29.606]
        origin: [0, 0]
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Lesotho'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Lesotho' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Lesotho'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Lesotho' group by 1, 2

            - name: Council
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Lesotho'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Lesotho' group by 1, 2

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years-ag
            observations:
                rain:
                    label: Rain
                    description: ENACTS average precipitation over the season
                    path: lesotho/enacts-precip-djf.zarr
                    var_names:
                        obs: rfe
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enso_state: *enso_ds
                bad-years-ag:
                    label: "Ag/food sec bad years"
                    description: Bad years for agriculture and food security sector
                    path: lesotho/bad-years.zarr
                    var_names:
                        obs: Agriculture and Food Security
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-dma-rep:
                    label: DMA district rep bad years
                    description: Bad years according to DMA district representative
                    path: lesotho/bad-years.zarr
                    var_names:
                        obs: "DMA district Representative"
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-dma-general:
                    label: DMA general bad years
                    description: DMA general bad years
                    path: lesotho/bad-years.zarr
                    var_names:
                        obs: "DMA district Representative"
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-humanitarian:
                    label: Humanitarian org bad years
                    description: Bad years according to humanitarian organizations
                    path: lesotho/bad-years.zarr
                    var_names:
                        obs: Humanitarian Organizations
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-natural-resources:
                    label: Natural resources bad years
                    description: Bad years for natural resources sector
                    path: lesotho/bad-years.zarr
                    var_names:
                        obs: Natural Resources
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-nutrition:
                    label: Nutrition bad years
                    description: Bad years for nutrition sector
                    path: lesotho/bad-years.zarr
                    var_names:
                        obs: Nutrition
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of selected percentile
                    path: lesotho/pnep-djf.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: DJF
                target_month: 0.5
                length: 3.0
                issue_months: [8, 9, 10]
                year_range: [1983, 2022]
    lesotho-ond:
        logo: Lesotho_IRI_94x48.png
        resolution: [.0375, .0375]
        center: [28.25625, -29.606]
        zoom: 8
        rotation: 0
        marker:  [28.25625, -29.606]
        origin: [0, 0]
        onload_warning: *warn
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Lesotho'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Lesotho' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Lesotho'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Lesotho' group by 1, 2

            - name: Council
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Lesotho'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Lesotho' group by 1, 2

        datasets:
            defaults:
                predictors:
                    - pnep
                    - rain
                predictand: bad-years-ag
            observations:
                rain:
                    label: Rain
                    description: ENACTS average precipitation over the season
                    path: lesotho/enacts-precip-ond.zarr
                    var_names:
                        obs: rfe
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                enso_state: *enso_ds
                bad-years-ag:
                    label: "Ag/food sec bad years"
                    description: Bad years for agriculture and food security sector
                    path: lesotho/bad-years-ond.zarr
                    var_names:
                        obs: Agriculture and Food Security
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-dma-rep:
                    label: DMA district rep bad years
                    description: Bad years according to DMA district representative
                    path: lesotho/bad-years-ond.zarr
                    var_names:
                        obs: "DMA district Representative"
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-dma-general:
                    label: DMA general bad years
                    description: DMA general bad years
                    path: lesotho/bad-years-ond.zarr
                    var_names:
                        obs: "DMA district Representative"
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-humanitarian:
                    label: Humanitarian org bad years
                    description: Bad years according to humanitarian organizations
                    path: lesotho/bad-years-ond.zarr
                    var_names:
                        obs: Humanitarian Organizations
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-natural-resources:
                    label: Natural resources bad years
                    description: Bad years for natural resources sector
                    path: lesotho/bad-years-ond.zarr
                    var_names:
                        obs: Natural Resources
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
                bad-years-nutrition:
                    label: Nutrition bad years
                    description: Bad years for nutrition sector
                    path: lesotho/bad-years-ond.zarr
                    var_names:
                        obs: Nutrition
                        time: T
                    colormap: *raincm
                    lower_is_worse: yes
                    format: number0
                    units: rank
            forecasts:
                pnep:
                    label: Forecast prob non-exc
                    description: NextGen forecast probability of non-exceedance of selected percentile
                    path: lesotho/pnep-ond.zarr
                    var_names:
                        pne: pne
                        lat: Y
                        lon: X
                        issue: S
                        lead: null  # dataset has forecasts for only one season; L is implicit.
                        pct: P
                    colormap: *pnepcm
                    lower_is_worse: no
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: OND
                target_month: 10.5
                length: 3.0
                issue_months: [6, 7, 8]
                year_range: [1983, 2022]
